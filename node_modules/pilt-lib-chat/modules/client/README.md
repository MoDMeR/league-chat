# pilt-lib-chat: module **client**

## Usage
``` javascript
var ChatClient = require("./"),
  Jid = require("../jid"),
  client = new ChatClient({
    accountName: "MyAccountName",
    password: "MyPassword",
    server: "NA"
  });

client.on("online", function () {
    console.log("Connected.");
});

client.on("offline", function () {
    console.log("Disconnected.");
});

client.on("message", function (message) {
    var sender = client.getFriendlist().filter(function (friend) {
        return (friend.jid === message.from);
    })[0].name;
    var text = message.body;
    console.log("%s: %s", sender, text);
});


// Friendlist
// The friendlist will always return friend objects
// which are instances of Friend from friend.js
var friend;
friend = client.friendlist.getFriendByName("Summonername");
friend = client.friendlist.getFriendByJid("s000000@pvp.net/resource");
friend = client.friendlist.getFriendByJid("s000000@pvp.net");
// The resource will always be ignored when querying for a friend

var jid = new Jid(/* ... */);
friend = client.friendlist.getFriendByJid(jid);
// You can also query by jid with an instance of Jid from the jid-package

var friendRequests = client.friendlist.getFriendRequests();
// Get an array of all open friendrequests (invites)
// friendrequests will be instances of FriendRequest from friend-request.js

client.friendlist.sendFriendRequestToName("Summonername");
client.friendlist.sendFriendRequestToJid(jid);
```

## General information

All supported servers can be found in the `servers.json` file.

The `ChatClient` class inherits from nodes `events.EventEmitter` class, so it inherits the 


## API
### `ChatClient(options)`
Constructs a client object with the given mandatory `options` object with the following fields.
``` javascript
{
    accountName: "", // String with your accountname. Not your summonername.
    password: "", // String with your accounts password
    server: "", // Case insensitive string with the server abbreviation
    replaceLeagueChat: false // Optional boolean weather you want the chat to replace the League Client chat or exist side by side (Defaults to false)
}
```


### `#isOnline()`
Returns a `boolean` wheather or not the client is online.


### `#isClosed()`
Returns a `boolean` wheather or not the connection is fully closed.

There is currently no way to reconnect a closed connection.


### `#getFriendlist()`
Returns the full `friendlist` array the client is currently aware of, like following.
``` javascript
[
	{
		jid: "", // JID of the friend
		name: "", // The friends summonername
		online: true, // Boolean wheather the friend is online or not
		note: "", // Optional string with the note you added for this friend
		group: { // Optional object with information about the group this friend is in
			name: "", // Name of the group
			priority: // Optional number which specifies the order of the group
		},
		statusColor: "", // Optional string with the color the friend appears in the League Client Chat
		status: "" // Optional string with the friends status-text
	},
	{ ... }
]
```


### `#disconnect()`
Disconnects the client and fully closes the connection.

There is currently no way to reconnect a closed connection.


### `#sendMessage(jid, message)`
With `jid` being a **valid JID** and `message` of type `string`

Sends a simple chat message to the specified jid.


### `#changePresence(color, [status])`
With `color` being a **valid chat availability color string** and `status` of type `string`

Changes the own presence and status.


### `#getOwnJid([includeResource])`
With `includeResource` of type `boolean`

Returns your own internal JID, which differs from the one used to authenticate.

### `#changeNote(jid, note)`
With `jid` being a **valid JID** and `note` of type `string`

Changes the user defined note of the user with the given JID.

Returns `true` if successful.

### `#changeGroup(jid, group, [priority])`
With `jid` being a **valid JID**, `group` being of type `string` and priority being a `number`

Changes the group the user with the given JID belongs to.

Returns `true` if successful.

### `#addListener(event, listener)`
### `#on(event, listener)`
Inherited from `events.EventEmitter`.
[See here for more info.](http://nodejs.org/api/events.html "Node.js Documentation: Events")

### `#once(event, listener)`
Inherited from `events.EventEmitter`.
[See here for more info.](http://nodejs.org/api/events.html "Node.js Documentation: Events")

### `#removeListener(event, listener)`
Inherited from `events.EventEmitter`.
[See here for more info.](http://nodejs.org/api/events.html "Node.js Documentation: Events")

### `#removeAllListeners([event])`
Inherited from `events.EventEmitter`.
[See here for more info.](http://nodejs.org/api/events.html "Node.js Documentation: Events")

### `#setMaxListeners(n)`
Inherited from `events.EventEmitter`.
[See here for more info.](http://nodejs.org/api/events.html "Node.js Documentation: Events")

### `#listeners(event)`
Inherited from `events.EventEmitter`.
[See here for more info.](http://nodejs.org/api/events.html "Node.js Documentation: Events")

### `#emit(event, [arg1], [arg2], [...])`
Inherited from `events.EventEmitter`.
[See here for more info.](http://nodejs.org/api/events.html "Node.js Documentation: Events")


## Events

### `error`
Emitted with the occurred `errorObject` which is an custom Error and instance of `Error`.

### `xmpp-error`
Emitted with the occurred `errorResponse` like following.

``` javascript
{
	stanzaType: "", // stanza-type on which the error occurred
	errorType: "", // One of [ "cancle", "continue", "modify", "auth", "wait" ] according to http://xmpp.org/rfcs/rfc3920.html#rfc.section.9.3.2
	text: "", // optional descriptive error text
	definedErrorConditions: [
		"gone",
		"not-allowed",
		"jid-malformed"
	], // List of camel-cased Defined Error Conditions according to http://xmpp.org/rfcs/rfc3920.html#rfc.section.9.3.3
	xml: "" // xml string of error stanza
}
```

### `online`
Emitted without data when the client connects to the server.

### `offline`
Emitted without data when the client closes the connection to the server.

### `presence`
Emitted with the presence-changing `friend` like following.

``` javascript
{
	jid: "", // JID of the friend
	name: "", // The friends summonername
	online: true, // Boolean wheather the friend is online of not
	note: "", // Optional string with the note you added for this friend
	group: { // Optional object with information about the group this friend is in
		name: "", // Name of the group
		priority: // Optional number which specifies the order of the group
	},
	statusColor: "", // Optional string with the color the friend appears in the League Client Chat
	status: "" // Optional string with the friends status-text
}
```

### `message`
Emitted with the received `message` like following.

``` javascript
{
	from: "", // JID of the sender
	date: new Date(), // Date the message was sent or if not accessible current date
	body: "" // string of the message-body or if not accessible ""
}
```

### `roster`
Emitted with the received full `friendlist` array like following.

``` javascript
[
	{
		jid: "", // JID of the friend
		name: "", // The friends summonername
		online: false, // Boolean wheather the friend is online or not
		note: "", // Optional string with the note you added for this friend
		group: { // Optional object with information about the group this friend is in
			name: "", // Name of the group
			priority: // Optional number which specifies the order of the group
		}
	},
	{ ... }
]
```

### `roster:update`
Emitted with the changing `friend` like following.
This is not the same as the `presence` event.
It can only occurr when the user actively changes information in his friendlist.

``` javascript
{
	jid: "", // JID of the friend
	name: "", // The friends summonername
	online: false, // Boolean wheather the friend is online or not
	note: "", // Optional string with the note you added for this friend
	group: { // Optional object with information about the group this frien$
		name: "", // Name of the group
		priority: // Optional number which specifies the order of the group
	}
}
```

### `newListener`
Inherited from `events.EventEmitter`.
[See here for more info.](http://nodejs.org/api/events.html "Node.js Documentation: Events")

### `removeListener`
Inherited from `events.EventEmitter`.
[See here for more info.](http://nodejs.org/api/events.html "Node.js Documentation: Events")


## Resources

### XMPP Settings

| Setting                | Value                        |
|:---------------------- |:---------------------------- |
| protocol               | XMPP                         |
| username               | &lt;your LoL accountname&gt; |
| password               | AIR_&lt; LoL password&gt;    |
| domain                 | pvp.net                      |
| connection security    | old-style SSL / legacy SSL   |
| connect port           | 5223                         |

### Server URLs

| Abbreviation | Region                   | URL                           |
|:------------ |:------------------------ |:----------------------------- |
| EUW          | EU West                  | chat.euw1.lol.riotgames.com   |
| EUNE         | EU Nordic & East         | chat.eun1.lol.riotgames.com   |
| US           | US                       | chat.na1.lol.riotgames.com    |
| PBE          | Public Beta Environment  | chat.pbe1.lol.riotgames.com   |
| OCE          | Oceania                  | chat.oc1.lol.riotgames.com    |
| BR           | Brazil                   | chat.br.lol.riotgames.com     |
| TR           | Turkey                   | chat.tr.lol.riotgames.com     |
| RU           | Russia                   | chat.ru.lol.riotgames.com     |
| LAN          | Latin America North      | chat.la1.lol.riotgames.com    |
| LAS          | Latin America South      | chat.la2.lol.riotgames.com    |
| TW           | Taiwan                   | chattw.lol.garenanow.com      |
| TH           | Thailand                 | chatth.lol.garenanow.com      |
| VN           | Vietnam                  | chatvn.lol.garenanow.com      |
| PH           | Phillipines              | chatph.lol.garenanow.com      |

### Sources

- [LoL Wikia ~Sevenix Connecting to the LoL chat using XMPP protocol](http://leagueoflegends.wikia.com/wiki/User:Sevenix/XMMP_Chat)
- [XMPP Defined Error Conditions](http://xmpp.org/rfcs/rfc3920.html#rfc.section.9.3.3)
